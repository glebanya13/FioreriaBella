<Page x:Class="FioreriaBella.MVVM.Views.CartView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:converters="clr-namespace:FioreriaBella.MVVM.Converters"
      Title="Carrello"
      x:Name="CartPage">
  <Page.Resources>
    <converters:ImagePathConverter x:Key="ImagePathConverter" />
  </Page.Resources>

  <Grid Background="Transparent">
    <Border Padding="30"
            BorderBrush="Goldenrod"
            BorderThickness="2"
            CornerRadius="16"
            Width="820"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Background="#FFFDF5F0"
            SnapsToDevicePixels="True">

      <StackPanel>

        <Button Content="← Назад"
                Width="100"
                Margin="0,0,0,15"
                HorizontalAlignment="Left"
                Style="{StaticResource ElegantButtonStyle}"
                Command="{Binding BackCommand}" />

        <TextBlock Text="Carrello"
                   FontSize="24"
                   FontFamily="Georgia"
                   FontWeight="Bold"
                   Foreground="DarkOliveGreen"
                   HorizontalAlignment="Center"
                   Margin="0,0,0,20"/>

        <DataGrid ItemsSource="{Binding CartItems}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  SelectionMode="Single"
                  SelectionUnit="Cell"
                  HeadersVisibility="Column"
                  RowHeight="60"
                  ColumnHeaderHeight="30"
                  Margin="0,0,0,10"
                  Style="{StaticResource ElegantDataGridStyle}">

          <DataGrid.Columns>
            <DataGridTemplateColumn Header="Изображение" Width="100">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                  <Image Source="{Binding Product.Picture, Converter={StaticResource ImagePathConverter}}"
                         Width="80"
                         Height="80"
                         Stretch="UniformToFill"
                         VerticalAlignment="Center"
                         HorizontalAlignment="Center"/>
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>

            <DataGridTemplateColumn Header="Название товара" Width="*">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                  <StackPanel VerticalAlignment="Center" Margin="4">
                    <TextBlock Text="{Binding Product.Name}"
                               TextWrapping="Wrap"
                               FontFamily="Palatino Linotype"
                               FontWeight="Bold"
                               FontSize="14"
                               Foreground="#4B2E2B"
                               Margin="0,0,0,5"/>
                    <TextBlock Text="{Binding Product.Description}"
                               TextWrapping="Wrap"
                               FontStyle="Italic"
                               FontSize="12"
                               Foreground="#6B4E3E"
                               TextTrimming="WordEllipsis"
                               MaxHeight="40"/>
                  </StackPanel>
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>

            <DataGridTemplateColumn Header="Количество" Width="150">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                  <StackPanel Orientation="Horizontal"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center">

                    <Button Content="−"
                            Width="25"
                            Height="25"
                            FontSize="16"
                            FontWeight="Bold"
                            Margin="2"
                            Command="{Binding DataContext.DecreaseQuantityCommand, ElementName=CartPage}"
                            CommandParameter="{Binding}"
                            Style="{StaticResource ElegantButtonStyle}"/>

                    <TextBox Text="{Binding Quantity, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             Width="40"
                             Height="25"
                             Margin="2"
                             HorizontalContentAlignment="Center"
                             VerticalContentAlignment="Center"
                             FontWeight="Bold"
                             Background="White"
                             BorderBrush="Goldenrod"
                             BorderThickness="1"/>

                    <Button Content="+"
                            Width="25"
                            Height="25"
                            FontSize="16"
                            FontWeight="Bold"
                            Margin="2"
                            Command="{Binding DataContext.IncreaseQuantityCommand, ElementName=CartPage}"
                            CommandParameter="{Binding}"
                            Style="{StaticResource ElegantButtonStyle}"/>
                  </StackPanel>
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>

            <DataGridTemplateColumn Header="Действия" Width="150">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                  <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <Button Width="30" Height="30"
                            Margin="3"
                            Style="{StaticResource IconButtonStyle}"
                            ToolTip="Удалить"
                            Command="{Binding DataContext.RemoveFromCartCommand, ElementName=CartPage}"
                            CommandParameter="{Binding}">
                      <Image Source="pack://application:,,,/MVVM/Resources/delete_icon.png" Width="18" Height="18"/>
                    </Button>
                  </StackPanel>
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>

          </DataGrid.Columns>
        </DataGrid>

        <TextBlock Text="{Binding Total, StringFormat=Итого: ₽{0:F2}}"
                   FontSize="18"
                   FontWeight="Bold"
                   Margin="0,10,0,20"
                   HorizontalAlignment="Right"
                   Foreground="DarkSlateGray"
                   FontFamily="Palatino Linotype"/>

        <Button Content="Оформить заказ"
                Width="180"
                Height="40"
                HorizontalAlignment="Right"
                Style="{StaticResource ElegantButtonStyle}"
                Command="{Binding CheckoutCommand}" />

      </StackPanel>
    </Border>
  </Grid>
</Page>
